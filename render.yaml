# P2PCLAW — Render Blueprint
# Conectar repo a Render Dashboard → New → Blueprint → seleccionar este repo
# Crea API backup + citizens2/3/4/5 (100 agentes total)
# Nota: workers requieren plan starter o superior (no free)
# Gateway: HuggingFace Spaces (gratuito, sin Railway)

services:
  # API Gateway backup — sirve la API y el frontend www.p2pclaw.com
  - type: web
    name: p2pclaw-api-backup
    runtime: node
    plan: free
    region: oregon
    buildCommand: npm install
    startCommand: node packages/api/src/index.js
    envVars:
      # Gateway: HF Node A como primario (gratuito)
      - key: GATEWAY
        value: https://agnuxo-p2pclaw-node-a.hf.space
      - key: RELAY_NODE
        value: https://agnuxo-p2pclaw-node-a.hf.space/gun
      - key: EXTRA_PEERS
        value: https://nautiluskit-p2pclaw-node-b.hf.space/gun,https://frank-agnuxo-p2pclaw-node-c.hf.space/gun,https://karmakindle1-p2pclaw-node-d.hf.space/gun
      - key: GROQ_API_KEY
        sync: false
      - key: PINATA_JWT
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: GITHUB_CLIENT_ID
        sync: false
      - key: GITHUB_CLIENT_SECRET
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      # TIER1_VERIFIER_URL: set once HF Space is deployed
      # TIER1_VERIFIER_URL=https://agnuxo-p2pclaw-lean4-verifier.hf.space
    buildFilter:
      paths:
        - packages/api/**/*
        - package.json
        - pnpm-lock.yaml
        - package-lock.json

  # ABRAXAS — Autonomous arXiv agent (Python worker)
  - type: worker
    name: p2pclaw-abraxas
    runtime: python
    plan: starter
    region: oregon
    buildCommand: pip install requests
    startCommand: python scripts/abraxas_agent_loop.py
    envVars:
      - key: GATEWAY
        value: https://agnuxo-p2pclaw-node-a.hf.space
      - key: GROQ_API_KEY
        sync: false

  # Citizens2 (20 agentes — LLM via Groq keys 1+2)
  - type: worker
    name: p2pclaw-citizens2
    runtime: node
    plan: starter
    region: oregon
    buildCommand: npm install
    startCommand: node packages/agents/citizens2.js
    envVars:
      - key: GATEWAY
        value: https://agnuxo-p2pclaw-node-a.hf.space
      - key: RELAY_NODE
        value: https://agnuxo-p2pclaw-node-a.hf.space/gun
      - key: EXTRA_PEERS
        value: https://nautiluskit-p2pclaw-node-b.hf.space/gun,https://frank-agnuxo-p2pclaw-node-c.hf.space/gun
      - key: SKIP_PAPERS
        value: "false"
      - key: GROQ_KEYS
        sync: false
      - key: OPENROUTER_KEYS
        sync: false
    buildFilter:
      paths:
        - packages/agents/**/*
        - package.json

  # Citizens3 (21 agentes — LLM via Groq keys 2+3)
  - type: worker
    name: p2pclaw-citizens3
    runtime: node
    plan: starter
    region: oregon
    buildCommand: npm install
    startCommand: node packages/agents/citizens3.js
    envVars:
      - key: GATEWAY
        value: https://nautiluskit-p2pclaw-node-b.hf.space
      - key: RELAY_NODE
        value: https://nautiluskit-p2pclaw-node-b.hf.space/gun
      - key: EXTRA_PEERS
        value: https://agnuxo-p2pclaw-node-a.hf.space/gun,https://frank-agnuxo-p2pclaw-node-c.hf.space/gun
      - key: SKIP_PAPERS
        value: "false"
      - key: GROQ_KEYS
        sync: false
      - key: OPENROUTER_KEYS
        sync: false

  # Citizens4 (21 agentes — LLM via Groq keys 3+4)
  - type: worker
    name: p2pclaw-citizens4
    runtime: node
    plan: starter
    region: oregon
    buildCommand: npm install
    startCommand: node packages/agents/citizens4.js
    envVars:
      - key: GATEWAY
        value: https://frank-agnuxo-p2pclaw-node-c.hf.space
      - key: RELAY_NODE
        value: https://frank-agnuxo-p2pclaw-node-c.hf.space/gun
      - key: EXTRA_PEERS
        value: https://agnuxo-p2pclaw-node-a.hf.space/gun,https://nautiluskit-p2pclaw-node-b.hf.space/gun
      - key: SKIP_PAPERS
        value: "false"
      - key: GROQ_KEYS
        sync: false
      - key: OPENROUTER_KEYS
        sync: false

  # Citizens5 (20 agentes — LLM via Groq keys 4+5)
  - type: worker
    name: p2pclaw-citizens5
    runtime: node
    plan: starter
    region: oregon
    buildCommand: npm install
    startCommand: node packages/agents/citizens5.js
    envVars:
      - key: GATEWAY
        value: https://karmakindle1-p2pclaw-node-d.hf.space
      - key: RELAY_NODE
        value: https://karmakindle1-p2pclaw-node-d.hf.space/gun
      - key: EXTRA_PEERS
        value: https://agnuxo-p2pclaw-node-a.hf.space/gun,https://frank-agnuxo-p2pclaw-node-c.hf.space/gun
      - key: SKIP_PAPERS
        value: "false"
      - key: GROQ_KEYS
        sync: false
      - key: OPENROUTER_KEYS
        sync: false
